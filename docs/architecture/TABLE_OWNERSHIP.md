# Table Ownership & Permissions

This document is the single source of truth for table ownership, write authorities, and satellite permissions in the Doveapp ecosystem. It defines the contract for multi-app boundaries and ensures all systems respect RLS-first data isolation.

Based on supabase/schema_baseline.sql and supabase/migrations/\*.sql. All tables have RLS enabled and filter by account_id unless noted otherwise.

Canonical Owner determines who has final authority over lifecycle-critical fields. Primary Producer indicates which system typically writes records (often drafts/events) without owning truth.

| Table                | Purpose                       | Canonical Owner | Primary Producer           | Canonical State? | Allowed Writers | Write Mode                                | Notes                                                                                          |
| -------------------- | ----------------------------- | --------------- | -------------------------- | ---------------- | --------------- | ----------------------------------------- | ---------------------------------------------------------------------------------------------- |
| account_memberships  | User-account role mappings    | Doveapp Core    | Doveapp Core               | Yes              | service_role    | CRUD                                      | Global-ish admin table; reads scoped by membership                                             |
| clients              | Customer contact records      | Doveapp Core    | Doveapp Core               | Yes              | authenticated   | CRUD                                      | RLS: account_id filter                                                                         |
| customers            | Portal customer profiles      | Doveapp Core    | Doveapp Core               | Yes              | authenticated   | CRUD                                      | Portal identity/profile; relates to clients (internal CRM)                                     |
| estimates            | Quote proposals and pricing   | Doveapp Core    | Estimator App              | Yes              | authenticated   | Draft-only (satellite) + lifecycle (core) | Estimator creates/edits drafts; Doveapp controls sent/accepted/rejected and conversion to jobs |
| invoices             | Billing documents             | Doveapp Core    | Doveapp Core               | Yes              | service_role    | CRUD                                      | Generated from jobs by Doveapp server routes; never client-written                             |
| jobs                 | Core work units and lifecycle | Doveapp Core    | Doveapp Core               | Yes              | authenticated   | CRUD                                      | Prefer satellites write events/notes; Doveapp finalizes lifecycle transitions                  |
| leads                | Sales pipeline records        | Doveapp Core    | Doveapp Core               | Yes              | authenticated   | CRUD                                      | RLS: account_id filter                                                                         |
| properties           | Physical locations            | Doveapp Core    | Doveapp Core               | Yes              | authenticated   | CRUD                                      | RLS: account_id filter                                                                         |
| technician_locations | GPS tracking data             | Event Log       | Automation Workers / Tech  | No               | authenticated   | Append-only                               | RLS: account_id filter; event log                                                              |
| time_entries         | Work time records             | Doveapp Core    | Automation Workers / Tech  | Yes              | authenticated   | CRUD                                      | Impacts billing; approvals manage workflow                                                     |
| technician_rates     | Pay rate configurations       | Doveapp Core    | Doveapp Core               | Yes              | authenticated   | CRUD                                      | RLS: account_id filter                                                                         |
| time_approvals       | Time entry approvals          | Workflow        | Automation Workers / Admin | No               | authenticated   | CRUD                                      | RLS: account_id filter; workflow state                                                         |
| time_breaks          | Break time records            | Event Log       | Automation Workers / Tech  | No               | authenticated   | Append-only                               | RLS: account_id filter; event log                                                              |
| visits               | Job site visit logs           | Event Log       | Automation Workers / Tech  | No               | authenticated   | Append-only                               | RLS: account_id filter; audit trail                                                            |
| job_notes            | Job activity and comments     | Doveapp Core    | AI App + Humans            | No               | authenticated   | Append-only                               | Append-only timeline/events; restrict edits/deletes (admin-only if ever allowed)               |
